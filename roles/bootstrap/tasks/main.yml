- name: Ensure base OS is up-to-date
  sudo: yes
  apt: upgrade=dist update_cache=yes

- name: Ensure ansible groups exists
  sudo: yes
  group: name=ansible state=present

- name: Ensure ansible user exists
  sudo: yes
  user: name=ansible comment="Ansible" groups="ansible,sudo"

- name: Set up authorized_keys for the deploy user
  sudo: yes
  authorized_key: user=ansible key="{{ item }}"
  with_file:
    - public-keys/alan@tableflip.io.id_rsa.pub
    - public-keys/oli@tableflip.io.id_rsa.pub
    - public-keys/richard@tableflip.io.id_rsa.pub

- name: Set ansible permissions in /etc/sudoers
  sudo: yes
  lineinfile: "dest=/etc/sudoers
              state=present
              line='ansible ALL=(ALL) NOPASSWD:ALL'
              validate='/usr/sbin/visudo -cf %s'"

- name: Set timezone variables
  sudo: yes
  copy: content='Europe/London'
        dest=/etc/timezone
        owner=root
        group=root
        mode=0644
        backup=yes
  notify:
    - update timezone

- name: Ensure ntp is installed
  sudo: yes
  apt: name=git state=present
